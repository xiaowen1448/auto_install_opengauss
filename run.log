[root@localhost ~]# ./install_opengauss.sh
=========================================
openGauss 自动安装脚本
支持多版本和多架构自动选择
内置URL版本 - 无需外部配置文件
=========================================
=========================================
支持的openGauss版本和架构:
=========================================
版本信息:
- openGauss 7.0.0-RC1  - 支持 x86_64, AArch64
- openGauss 6.0.2(LTS) - 支持 x86_64, AArch64
- openGauss 6.0.1(LTS) - 支持 x86_64, AArch64
- openGauss 6.0.0(LTS) - 支持 x86_64, AArch64
- openGauss 6.0.0-RC1 - 支持 x86_64, AArch64
- openGauss 5.0.3(LTS) - 支持 x86_64, AArch64
- openGauss 5.0.2(LTS) - 支持 x86_64, AArch64
- openGauss 5.0.1(LTS) - 支持 x86_64, AArch64
- openGauss 5.0.0(LTS) - 支持 x86_64, AArch64

系统要求:
- 操作系统: openEuler 22.03
- 架构: x86_64 或 AArch64
- 内存: 建议8GB以上
- 磁盘: 建议50GB以上可用空间
=========================================
检测到系统架构: x86_64
=========================================
可用的openGauss版本:
=========================================
1. openGauss 7.0.0-RC1 (v7.0.0-RC1) - 最新候选发布版本，包含新特性
2. openGauss 6.0.2(LTS) (v6.0.2) - 最新长期支持版本，推荐生产环境使用 ⭐推荐
3. openGauss 6.0.0(LTS) (v6.0.0) - 稳定长期支持版本
4. openGauss 6.0.0-RC1 (v6.0.0-RC1) - 稳定长期支持版本
5. openGauss 5.0.3(LTS) (v5.0.3) - 稳定长期支持版本
6. openGauss 5.0.2(LTS) (v5.0.2) - 稳定长期支持版本
7. openGauss 5.0.1(LTS) (v5.0.1) - 稳定长期支持版本
8. openGauss 5.0.0(LTS) (v5.0.0) - 稳定长期支持版本
=========================================
系统架构: x86_64
支持的操作系统: openEuler 22.03 / openEuler
=========================================
请选择要安装的版本 (输入数字 1-8): 1

✅ 您选择了: openGauss 7.0.0-RC1 (v7.0.0-RC1)
架构: x86_64
特性: 候选发布版本，包含最新功能，适合测试环境

正在构建下载链接...
目标版本: 7.0.0-RC1
系统架构: x86_64
构建的下载链接: https://opengauss.obs.cn-south-1.myhuaweicloud.com/7.0.0-RC1/openEuler22.03/x86/openGauss-All-7.0.0-RC1-openEuler22.03-x86_64.tar.gz
=========================================
开始下载openGauss安装包...
下载链接: https://opengauss.obs.cn-south-1.myhuaweicloud.com/7.0.0-RC1/openEuler22.03/x86/openGauss-All-7.0.0-RC1-openEuler22.03-x86_64.tar.gz
文件名: openGauss-All-7.0.0-RC1-openEuler22.03-x86_64.tar.gz
=========================================
使用wget下载...
--2025-09-30 12:13:39--  https://opengauss.obs.cn-south-1.myhuaweicloud.com/7.0.0-RC1/openEuler22.03/x86/openGauss-All-7.0.0-RC1-openEuler22.03-x86_64.tar.gz
正在解析主机 opengauss.obs.cn-south-1.myhuaweicloud.com (opengauss.obs.cn-south-1.myhuaweicloud.com)... 139.159.208.64, 139.159.208.243, 139.159.208.230, ...
正在连接 opengauss.obs.cn-south-1.myhuaweicloud.com (opengauss.obs.cn-south-1.myhuaweicloud.com)|139.159.208.64|:443... 已连接。
已发出 HTTP 请求，正在等待回应... 200 OK
长度：164515027 (157M) [application/gzip]
正在保存至: “openGauss-All-7.0.0-RC1-openEuler22.03-x86_64.tar.gz”

openGauss-All-7.0.0-RC1-openEuler22.03-x86_64 100%[===============================================================================================>] 156.89M  28.0MB/s  用时 5.9s

2025-09-30 12:13:46 (26.5 MB/s) - 已保存 “openGauss-All-7.0.0-RC1-openEuler22.03-x86_64.tar.gz” [164515027/164515027])

下载完成: openGauss-All-7.0.0-RC1-openEuler22.03-x86_64.tar.gz (大小: 164515027 bytes)
检查系统版本...

NAME="openEuler"
VERSION="22.03 (LTS-SP3)"
VERSION_ID="22.03"
PRETTY_NAME="openEuler 22.03 (LTS-SP3)"
=========================================
配置主机名...
当前主机名: localhost.localdomain
需要将主机名从 'localhost.localdomain' 更改为 'host01'
正在更改主机名...
✅ 主机名更改成功: host01
主机名配置状态:
 Static hostname: host01
       Icon name: computer-vm
      Machine ID: 76f0e5847d014590b41da5805c7fc730
检测到本机IP地址: 192.168.119.160
=========================================
步骤1: 安装必要工具...
Last metadata expiration check: 0:01:10 ago on 2025年09月30日 星期二 12时12分51秒.
Dependencies resolved.
======================================================================================================================================================================================
 Package                                 Architecture                            Version                                                Repository                               Size
======================================================================================================================================================================================
Installing:
 expect                                  x86_64                                  1:5.45.4-8.oe2203sp3                                   update                                  239 k
 tar                                     x86_64                                  2:1.34-5.oe2203sp3                                     OS                                      784 k

Transaction Summary
======================================================================================================================================================================================
Install  2 Packages

Total download size: 1.0 M
Installed size: 3.9 M
Downloading Packages:
(1/2): expect-5.45.4-8.oe2203sp3.x86_64.rpm                                                                                                           468 kB/s | 239 kB     00:00
(2/2): tar-1.34-5.oe2203sp3.x86_64.rpm                                                                                                                604 kB/s | 784 kB     00:01
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Total                                                                                                                                                 565 kB/s | 1.0 MB     00:01
retrieving repo key for OS unencrypted from http://repo.openeuler.org/openEuler-22.03-LTS-SP3/OS/x86_64/RPM-GPG-KEY-openEuler
OS                                                                                                                                                    5.3 kB/s | 3.0 kB     00:00
Importing GPG key 0xB675600B:
 Userid     : "openeuler <openeuler@compass-ci.com>"
 Fingerprint: 8AA1 6BF9 F2CA 5244 010D CA96 3B47 7C60 B675 600B
 From       : http://repo.openeuler.org/openEuler-22.03-LTS-SP3/OS/x86_64/RPM-GPG-KEY-openEuler
Key imported successfully
Running transaction check
Transaction check succeeded.
Running transaction test
Transaction test succeeded.
Running transaction
  Preparing        :                                                                                                                                                              1/1
  Installing       : expect-1:5.45.4-8.oe2203sp3.x86_64                                                                                                                           1/2
  Running scriptlet: expect-1:5.45.4-8.oe2203sp3.x86_64                                                                                                                           1/2
  Running scriptlet: tar-2:1.34-5.oe2203sp3.x86_64                                                                                                                                2/2
  Installing       : tar-2:1.34-5.oe2203sp3.x86_64                                                                                                                                2/2
  Running scriptlet: tar-2:1.34-5.oe2203sp3.x86_64                                                                                                                                2/2
  Verifying        : tar-2:1.34-5.oe2203sp3.x86_64                                                                                                                                1/2
  Verifying        : expect-1:5.45.4-8.oe2203sp3.x86_64                                                                                                                           2/2

Installed:
  expect-1:5.45.4-8.oe2203sp3.x86_64                                                           tar-2:1.34-5.oe2203sp3.x86_64

Complete!
步骤2: 创建安装目录...
步骤3: 切换到安装目录...
步骤4: 解压openGauss安装包...
正在检测OM包...
找到OM包: ./openGauss-OM-7.0.0-RC1-openEuler22.03-x86_64.tar.gz
解压OM包...
✅ OM包解压完成
步骤5: 创建集群配置文件...
✅ 集群配置文件创建完成
配置信息:
- 主机名: host01
- IP地址: 192.168.119.160
- 数据库端口: 15400
- 选择版本: 7.0.0-RC1
- 系统架构: x86_64
- 下载链接: https://opengauss.obs.cn-south-1.myhuaweicloud.com/7.0.0-RC1/openEuler22.03/x86/openGauss-All-7.0.0-RC1-openEuler22.03-x86_64.tar.gz
步骤6: 设置目录权限...
步骤7: 执行预安装...
正在执行预安装，这可能需要几分钟时间...
将自动创建omm用户并设置密码为: Admin@2025

spawn ./gs_preinstall -U omm -G dbgrp -X /opt/software/openGauss/cluster_config.xml
Parsing the configuration file.
Successfully parsed the configuration file.
Installing the tools on the local node.
Successfully installed the tools on the local node.
Setting host ip env
Successfully set host ip env.
Are you sure you want to create the user[omm] (yes/no)? yes
Please enter password for cluster user.
Password:
Please enter password for cluster user again.
Password:
Generate cluster user password files successfully.
Successfully created [omm] user on all nodes.
Preparing SSH service.
Successfully prepared SSH service.
Checking OS software.
Successfully check OS software.
Checking OS version.
Successfully checked OS version.
Checking cpu instructions.
Successfully checked cpu instructions.
Creating cluster's path.
Successfully created cluster's path.
Set and check OS parameter.
Setting OS parameters.
Successfully set OS parameters.
Warning: Installation environment contains some warning messages.
Please get more details by "/opt/software/openGauss/script/gs_checkos -i A -h host01 -X /opt/software/openGauss/cluster_config.xml --detail".
Set and check OS parameter completed.
Preparing CRON service.
Successfully prepared CRON service.
Setting user environmental variables.
Successfully set user environmental variables.
Setting the dynamic link library.
Successfully set the dynamic link library.
Setting Core file
Successfully set core path.
Setting pssh path
Successfully set pssh path.
Setting Cgroup.
Successfully set Cgroup.
Set ARM Optimization.
No need to set ARM Optimization.
Fixing server package owner.
Setting finish flag.
Successfully set finish flag.
Preinstallation succeeded.
预安装成功完成
预安装完成！

=========================================
预安装已完成，omm用户已创建
用户名: omm
密码: Admin@2025

开始执行数据库安装...
=========================================
正在切换到omm用户并执行数据库安装...
上一次登录： 二 9月 30 12:15:27 CST 2025
spawn gs_install -X /opt/software/openGauss/cluster_config.xml
Parsing the configuration file.
Successfully checked gs_uninstall on every node.
Check preinstall on every node.
Successfully checked preinstall on every node.
Creating the backup directory.
Successfully created the backup directory.
begin deploy..
Installing the cluster.
begin prepare Install Cluster..
Checking the installation environment on all nodes.
begin install Cluster..
Installing applications on all nodes.
Successfully installed APP.
begin init Instance..
encrypt cipher and rand files for database.
Please enter password for database:
Please repeat for database:
begin to create CA cert files
The sslcert will be generated in /opt/huawei/install/app/share/sslcert/om
NO cm_server instance, no need to create CA for CM.
Non-dss_ssl_enable, no need to create CA for DSS
Cluster installation is completed.
Configuring.
Deleting instances from all nodes.
Successfully deleted instances from all nodes.
Checking node configuration on all nodes.
Initializing instances on all nodes.
Updating instance configuration on all nodes.
Check consistence of memCheck and coresCheck on database nodes.
Configuring pg_hba on all nodes.
Configuration is completed.
The cluster status is Normal.
Successfully started cluster.
Successfully installed application.
end deploy..
openGauss数据库安装完成！
=========================================
数据库版本信息:
gsql (openGauss 7.0.0-RC1 build cff7b04d) compiled at 2025-03-28 11:56:19 commit 0 last mr

数据库信息：
- 版本: 7.0.0-RC1
- 架构: x86_64
- 用户名: omm
- 用户密码: Admin@2025
- 数据库密码: Admin@2025
- 数据库端口: 15400
- 下载源: https://opengauss.obs.cn-south-1.myhuaweicloud.com/7.0.0-RC1/openEuler22.03/x86/openGauss-All-7.0.0-RC1-openEuler22.03-x86_64.tar.gz

常用命令：
1. 查看数据库状态: gs_om -t status
2. 连接数据库: gsql -d postgres -p 15400
3. 启动数据库: gs_om -t start
4. 停止数据库: gs_om -t stop
=========================================

注意事项：
- 请确保系统已关闭防火墙和SELinux
- 请确保系统时间同步
- 如果遇到权限问题，请检查用户和组是否正确创建
- 默认数据库端口为15400
- omm用户密码为: Admin@2025

安装脚本执行完成！
[root@localhost ~]#